import{a as oe}from"./chunk-S5EKIQAW.js";import{a as w}from"./chunk-GSNWQ4FR.js";import"./chunk-AT26J2S3.js";import{a as S}from"./chunk-6ODF7MUU.js";import{c as D}from"./chunk-WB4RW6JM.js";import{a as z,b as G,c as A}from"./chunk-TEBHIWMK.js";import"./chunk-NDYST4XC.js";import"./chunk-CC3LA27V.js";import"./chunk-7XIEKY6O.js";import{a as V,d as Q,g as R,s as Z}from"./chunk-FSRSBQOR.js";import{H as F,J as $}from"./chunk-6SOKX3XS.js";import"./chunk-IX6G3U3V.js";import"./chunk-2URDVIT7.js";import{Db as v,Ib as _,Jb as M,Kb as P,Mb as m,Sa as B,Sb as I,Tb as x,Ua as l,Ub as L,Va as u,Wb as b,ga as f,kb as E,mb as h,rb as j,vb as d,wb as c,xb as g}from"./chunk-TDWWCWZI.js";import"./chunk-FK6H3RFT.js";import{f as ae,h as N}from"./chunk-DLDOR3YA.js";var W=ae(oe());var q=(()=>{let n=class n{constructor(t){this.loginServicve=t,this.logs=[]}ngOnInit(){this.getData()}getData(){return N(this,null,function*(){this.logs=yield this.loginServicve.getAllLogs()})}descargarCSV(){let a=["fecha,userEmail",...this.getCSVFormatData()(this.logs).map(o=>`${o.fecha},${o.userEmail}`)];W.saveAs(this.getBlob(a),`${this.getFileName()}.csv`)}getCSVFormatData(){return t=>t.map(e=>({fecha:this.getFormattedDate(e.fecha)||"-",userEmail:e.userEmail||"-"}))}getFormattedDate(t){let e=new Date(t.toDate()),a=e.getDate(),o=e.getMonth()+1,i=e.getFullYear(),s=e.getHours(),y=e.getMinutes(),p=e.getSeconds(),C=a<10?`0${a}`:a,T=o<10?`0${o}`:o,k=s<10?`0${s}`:s,ee=y<10?`0${y}`:y,te=p<10?`0${p}`:p;return`${C}/${T}/${i} ${k}:${ee}:${te}`}getFileName(){let t=new Date;return`Logs_Clinica_San_Francisco_${t.getFullYear()}-${this.padZero(t.getMonth()+1)}-${this.padZero(t.getDate())}_${this.padZero(t.getHours())}-${this.padZero(t.getMinutes())}-${this.padZero(t.getSeconds())}`}getBlob(t){let e=t.join(`
`);return new Blob([e],{type:"text/csv;charset=utf-8"})}padZero(t){return t<10?`0${t}`:`${t}`}};n.\u0275fac=function(e){return new(e||n)(u($))},n.\u0275cmp=f({type:n,selectors:[["app-logs"]],standalone:!0,features:[b],decls:8,vars:1,consts:[[1,"container-fluid"],[1,"d-flex","justify-content-center","btn-container"],["appCursorPointer","",1,"log-card",3,"click"],[1,"image-container"],["alt","Logs",1,"log-image",3,"src"],[1,"overlay"],[1,"log-name"]],template:function(e,a){e&1&&(d(0,"div",0)(1,"div",1)(2,"div",2),v("click",function(){return a.descargarCSV()}),d(3,"div",3),g(4,"img",4),d(5,"div",5)(6,"div",6),m(7,"Descargar Logs"),c()()()()()()),e&2&&(l(4),h("src","../../../../assets/log.png",B))},dependencies:[z],styles:['.btn-container[_ngcontent-%COMP%]{background-color:transparent;margin:1em}.log-image[_ngcontent-%COMP%]{border-radius:50%;width:200px;height:200px;object-fit:cover;display:block;background-color:#2fa22f}.overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-direction:column;background-color:#0006;color:#fff;opacity:0;transition:opacity .3s ease}.image-container[_ngcontent-%COMP%]:hover   .overlay[_ngcontent-%COMP%]{opacity:1}.log-name[_ngcontent-%COMP%]{margin-bottom:.5em;font-size:1.2em}.log-card[_ngcontent-%COMP%]{position:relative;margin:1em}.image-container[_ngcontent-%COMP%]{position:relative;display:inline-block}.container-fluid[_ngcontent-%COMP%]{height:35vh;background-color:#6ad8d4;background-image:url("./media/main_fondo-S2RK2XML.png");background-size:250px 250px;background-repeat:repeat;background-position:center;padding:20px}']});let r=n;return r})();var H=(()=>{let n=class n{constructor(t,e){this.toast=t,this.turnosService=e,this.barChartLabels=[],this.barChartData=[{data:[],label:"Cantidad de Turnos seg\xFAn especialidad"}],this.barChartOptions={responsive:!0,width:"400px",height:"200px",backgroundColor:"#0cb7f2"},this.turnos=[]}ngOnInit(){this.turnosService.getAllTurnos().subscribe(t=>{this.turnos=t,this.filterData()})}filterData(){let t=this.turnos.reduce((e,a)=>(a.especialidad&&(e[a.especialidad]=(e[a.especialidad]||0)+1),e),{});this.updateChart(t)}updateChart(t){let e=Object.entries(t).sort((a,o)=>a[1]-o[1]);this.barChartLabels=e.map(a=>a[0]),this.barChartData=[{data:e.map(a=>a[1]),label:"Cantidad de Turnos seg\xFAn especialidad"}]}downloadPDF(){try{let t=new w,e=this.chart?.toBase64Image();e?(t.addImage(e,"PNG",10,10,180,160),t.save("grafico_turnos_por_especialidad.pdf")):this.toast.error("No se puedo descargar el PDF")}catch(t){console.log(t)}}};n.\u0275fac=function(e){return new(e||n)(u(F),u(S))},n.\u0275cmp=f({type:n,selectors:[["app-graf-turnos-por-especialidad"]],viewQuery:function(e,a){if(e&1&&_(D,5),e&2){let o;M(o=P())&&(a.chart=o.first)}},standalone:!0,features:[b],decls:7,vars:3,consts:[[1,"container-fluid"],[1,"container","mt-4"],[1,"row","container","graph-container"],["baseChart","","type","bar",3,"datasets","labels","options"],[1,"btn","btn-success","btn-pdf",3,"click"]],template:function(e,a){e&1&&(d(0,"div",0)(1,"div",1)(2,"div",2),g(3,"canvas",3)(4,"br"),d(5,"button",4),v("click",function(){return a.downloadPDF()}),m(6,"Descargar"),c()()()()),e&2&&(l(3),h("datasets",a.barChartData)("labels",a.barChartLabels)("options",a.barChartOptions))},dependencies:[D],styles:['.container-fluid[_ngcontent-%COMP%]{height:85vh;background-color:#6ad8d4;background-image:url("./media/main_fondo-S2RK2XML.png");background-size:250px 250px;background-repeat:repeat;background-position:center;padding:20px}.graph-container[_ngcontent-%COMP%]{background-color:#fff;padding-bottom:1em}.mt-4[_ngcontent-%COMP%]{height:800px}.btn-pdf[_ngcontent-%COMP%]{margin-top:1em}']});let r=n;return r})();var U=(()=>{let n=class n{constructor(t,e){this.toast=t,this.turnosService=e,this.barChartLabels=[],this.barChartData=[{data:[],label:"Cantidad de Turnos por d\xEDa"}],this.barChartOptions={responsive:!0,width:"400px",height:"200px",backgroundColor:"#ffa420",fill:!0},this.turnos=[]}ngOnInit(){this.turnosService.getAllTurnos().subscribe(t=>{this.turnos=t,this.filterData()})}filterData(){let t={};this.turnos.forEach(e=>{let a=e.fecha.fecha,o=e.fecha.dayName;if(!a||!o){console.error("Fecha o d\xEDa no definido para el turno:",e);return}t[o]||(t[o]=[]);let i=t[o].find(s=>s.fecha===a);i?i.cantidad++:t[o].push({fecha:a,cantidad:1})}),this.updateChart(t)}orderByDate(t,e){let a=/^(\d{2})-(\d{2})-(\d{4})$/,o=t.match(a),i=o?parseInt(o[1],10):0,s=o?parseInt(o[2],10):0,y=o?parseInt(o[3],10):0,p=e.match(a),C=p?parseInt(p[1],10):0,T=p?parseInt(p[2],10):0,k=p?parseInt(p[3],10):0;return y!==k?y-k:s!==T?s-T:i-C}updateChart(t){let e=new Set,a=Object.entries(t).map(([i,s])=>{let y=s.map(C=>C.fecha),p=s.map(C=>C.cantidad);return s.forEach(C=>e.add(C.fecha)),{labels:y,data:p}}),o=Array.from(e).sort((i,s)=>this.orderByDate(i,s));this.barChartLabels=o,this.barChartData=[{data:this.fillDataWithZero(o,a.flatMap(i=>i.data),o),label:"Turnos por d\xEDa"}]}fillDataWithZero(t,e,a){return a.map(o=>{let i=t.indexOf(o);return i!==-1?e[i]:0})}downloadPDF(){try{let t=new w,e=this.chart?.toBase64Image();e?(t.addImage(e,"PNG",10,10,180,160),t.save("grafico_turnos_por_dia.pdf")):this.toast.error("No se puedo descargar el PDF")}catch(t){console.log(t)}}};n.\u0275fac=function(e){return new(e||n)(u(F),u(S))},n.\u0275cmp=f({type:n,selectors:[["app-graph-turnos-por-dia"]],viewQuery:function(e,a){if(e&1&&_(D,5),e&2){let o;M(o=P())&&(a.chart=o.first)}},standalone:!0,features:[b],decls:7,vars:3,consts:[[1,"container-fluid"],[1,"container","mt-4"],[1,"row","container","graph-container"],["baseChart","","type","bar",3,"datasets","labels","options"],[1,"btn","btn-success","btn-pdf",3,"click"]],template:function(e,a){e&1&&(d(0,"div",0)(1,"div",1)(2,"div",2),g(3,"canvas",3)(4,"br"),d(5,"button",4),v("click",function(){return a.downloadPDF()}),m(6,"Descargar"),c()()()()),e&2&&(l(3),h("datasets",a.barChartData)("labels",a.barChartLabels)("options",a.barChartOptions))},dependencies:[D],styles:['.container-fluid[_ngcontent-%COMP%]{height:85vh;background-color:#6ad8d4;background-image:url("./media/main_fondo-S2RK2XML.png");background-size:250px 250px;background-repeat:repeat;background-position:center;padding:20px}.graph-container[_ngcontent-%COMP%]{background-color:#fff;padding-bottom:1em}.mt-4[_ngcontent-%COMP%]{height:800px}.btn-pdf[_ngcontent-%COMP%]{margin-top:1em}']});let r=n;return r})();function ne(r,n){r&1&&(d(0,"label",4),m(1,"\u25CF Resultados del 1ro del mes actual al 1ro del mes siguiente"),c())}var J=(()=>{let n=class n{constructor(t,e){this.toast=t,this.turnosService=e,this.filterByFinalizados=!1,this.label="",this.pdfName="",this.barChartLabels=[],this.barChartData=[{data:[],label:this.label}],this.barChartOptions={responsive:!0,width:"400px",height:"200px",backgroundColor:"lightgreen",scales:{y:{beginAtZero:!0}}},this.contadorVeces=0,this.isFirstTime=!0,this.turnos=[];let{start:a,end:o}=this.getThisMonthRange();this.startDate=a,this.endDate=o}ngOnInit(){this.turnosService.getAllTurnos().subscribe(t=>{this.turnos=t,this.filterData()})}getThisMonthRange(){let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1),a=new Date(t.getFullYear(),t.getMonth()+1,1);return{start:e,end:a}}parseDate(t){let[e,a,o]=t.split("-").map(i=>parseInt(i,10));return!isNaN(e)&&!isNaN(a)&&!isNaN(o)?new Date(o,a-1,e):new Date("min")}filterData(){let t=this.startDate?new Date(this.startDate):new Date("1970-01-01"),e=this.endDate?new Date(this.endDate):new Date,a=this.turnos.filter(i=>{let s=this.parseDate(i.fecha.fecha);return s>=t&&s<=e});this.filterByFinalizados&&(a=a.filter(i=>i.estado=="finalizado"));let o=a.reduce((i,s)=>(s.especialistaId&&(i[s.especialistaId]=(i[s.especialistaId]||0)+1),i),{});this.showInitialMessage(),this.updateChart(o)}updateChart(t){let e=Object.entries(t).sort((a,o)=>a[1]-o[1]);this.barChartLabels=e.map(a=>a[0]),this.barChartData=[{data:e.map(a=>a[1]),label:this.label}],this.chart?.update()}downloadPDF(){try{let t=new w,e=this.chart?.toBase64Image();e?(t.addImage(e,"PNG",10,10,180,160),t.save(this.pdfName)):this.toast.error("No se pudo descargar el PDF")}catch(t){console.log(t)}}showInitialMessage(){this.isFirstTime&&(this.contadorVeces++,this.contadorVeces>1&&(this.isFirstTime=!1))}};n.\u0275fac=function(e){return new(e||n)(u(F),u(S))},n.\u0275cmp=f({type:n,selectors:[["app-graph-turnos-por-medico-lapso-tiempo"]],viewQuery:function(e,a){if(e&1&&_(D,5),e&2){let o;M(o=P())&&(a.chart=o.first)}},inputs:{filterByFinalizados:"filterByFinalizados",label:"label",pdfName:"pdfName"},standalone:!0,features:[b],decls:17,vars:6,consts:[[1,"container-fluid"],[1,"container","mt-4"],[1,"row","container","graph-container"],[1,"d-flex","justify-content-evenly"],[1,"form-label"],["for","startDate",1,"form-label"],["type","date","id","startDate",1,"form-control",3,"ngModelChange","ngModel"],["for","endDate",1,"form-label"],["type","date","id","endDate",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click"],["baseChart","","type","bar",3,"datasets","labels","options"],[1,"btn","btn-success","btn-pdf",3,"click"]],template:function(e,a){e&1&&(d(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),E(4,ne,2,0,"label",4),d(5,"label",5),m(6,"Fecha de Inicio:"),c(),d(7,"input",6),L("ngModelChange",function(i){return x(a.startDate,i)||(a.startDate=i),i}),c(),d(8,"label",7),m(9,"Fecha de Fin:"),c(),d(10,"input",8),L("ngModelChange",function(i){return x(a.endDate,i)||(a.endDate=i),i}),c(),d(11,"button",9),v("click",function(){return a.filterData()}),m(12,"Filtrar"),c()(),g(13,"canvas",10)(14,"br"),d(15,"button",11),v("click",function(){return a.downloadPDF()}),m(16,"Descargar"),c()()()()),e&2&&(l(4),j(4,a.isFirstTime?4:-1),l(3),I("ngModel",a.startDate),l(3),I("ngModel",a.endDate),l(3),h("datasets",a.barChartData)("labels",a.barChartLabels)("options",a.barChartOptions))},dependencies:[D,Z,V,Q,R],styles:['.container-fluid[_ngcontent-%COMP%]{height:85vh;background-color:#6ad8d4;background-image:url("./media/main_fondo-S2RK2XML.png");background-size:250px 250px;background-repeat:repeat;background-position:center;padding:20px}.graph-container[_ngcontent-%COMP%]{background-color:#fff;padding-top:1em;padding-bottom:1em}.mt-4[_ngcontent-%COMP%]{height:800px}.btn-pdf[_ngcontent-%COMP%]{margin-top:1em}.form-label[_ngcontent-%COMP%]{padding-top:.7em}.form-control[_ngcontent-%COMP%]{width:200px}']});let r=n;return r})();var Me=(()=>{let n=class n{constructor(){this.filterByFinalizados=!1,this.label="",this.pdfName=""}};n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=f({type:n,selectors:[["app-graficos-container"]],standalone:!0,features:[b],decls:8,vars:6,consts:[[1,"container-fluid","m-0","p-0"],[3,"filterByFinalizados","label","pdfName"]],template:function(e,a){e&1&&(d(0,"div",0),g(1,"app-navbar")(2,"app-graf-turnos-por-especialidad")(3,"app-graph-turnos-por-dia")(4,"app-graph-turnos-por-medico-lapso-tiempo",1)(5,"app-graph-turnos-por-medico-lapso-tiempo",1)(6,"app-logs")(7,"app-footer"),c()),e&2&&(l(4),h("filterByFinalizados",!1)("label","Cantidad de Turnos por m\xE9dico seg\xFAn lapso de tiempo")("pdfName","grafico_turnos_por_medico_segun_lapso_tiempo.pdf"),l(),h("filterByFinalizados",!0)("label","Cantidad de Turnos finalizados por m\xE9dico seg\xFAn lapso de tiempo")("pdfName","grafico_turnos_finalizados_por_medico_segun_lapso_tiempo.pdf"))},dependencies:[q,U,J,G,A,H]});let r=n;return r})();export{Me as GraficosContainerComponent};
