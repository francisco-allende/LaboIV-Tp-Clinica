import{A as v,B as I,C as S,D as L,E as A,F as j,I as h,J as l,K as d,P as k,u as p,v as y,w as E,z as b}from"./chunk-KOE6HBMH.js";import{h as f}from"./chunk-2URDVIT7.js";import{Y as g,ba as s,g as m}from"./chunk-TDWWCWZI.js";import{h as i}from"./chunk-DLDOR3YA.js";var $=(()=>{let r=class r{constructor(e,t,o,a){this.firestore=e,this.auth=t,this.toast=o,this.router=a,this.loggedUser=new m(null),this.loggedUserKey="loggedUserEmail",this.setLoggedUser=c=>this.loggedUser=c,this.getLoggedUser=()=>localStorage.getItem(this.loggedUserKey),this.configureAuthPersistence(),I(this.auth,c=>{})}configureAuthPersistence(){return i(this,null,function*(){try{yield p(this.auth,y)}catch(e){console.error("Error setting persistence:",e)}})}addToLogger(e){try{let t=l(this.firestore,"logs");h(t,{userEmail:e,fecha:new Date})}catch(t){console.error("Error en el add a los logs:",t)}}getAllLogs(){return i(this,null,function*(){try{let e=l(this.firestore,"logs"),t=yield d(e),o=[];return t.forEach(a=>{o.push(a.data())}),o}catch(e){throw console.error("Error obteniendo los logs:",e),e}})}isEmailVerificated(){return v().currentUser?.emailVerified}login(e,t){return i(this,null,function*(){L(this.auth,e,t).then(o=>{o.user.email!=null&&(this.isEmailVerificated()?(this.addToLogger(o.user.email),this.setLoggedUser(o.user.email),localStorage.setItem(this.loggedUserKey,e),this.toast.success(`Nos alegra verte de nuevo ${o.user.email}`),this.router.navigateByUrl("/home")):this.toast.error("Debe validar su cuenta en su email para loguearse"))}).catch(o=>{switch(o.code){case"auth/invalid-credential":this.toast.error("Usuario inexistente o contrase\xF1a incorrecta");break;default:this.toast.error("Sucedi\xF3 un error al intentar loguearse");break}console.log(`error en el login: ${o.code}`)})})}logOut(){A(this.auth).then(()=>{localStorage.removeItem(this.loggedUserKey),this.setLoggedUser("")})}register(e){return i(this,null,function*(){b(this.auth,e.email,e.password).then(t=>{if(t.user.email!=null){this.setLoggedUser(t.user.email);let o=l(this.firestore,"users");h(o,{nombre:e.nombre,apellido:e.apellido,edad:e.edad,dni:e.dni,email:e.email,password:e.password,rol:e.rol,mainImg:e.mainImg,extraImg:e.extraImg?e.extraImg:"",obraSocial:e.obraSocial,especialidad:e.especialidad,estado:e.estado,turnos:[],horarios:[],historiaClinica:[]}),this.toast.success("Usuario creado con \xE9xito",`Enviamos un mail de verificacion a ${t.user.email}`),this.router.navigateByUrl("/enviar_email"),S(t.user)}}).catch(t=>{switch(t.code){case"auth/invalid-email":this.toast.error("Email invalido");break;case"auth/email-already-in-use":this.toast.error("Email ya en uso");break;default:this.toast.error("Sucedi\xF3 un error inesperado"),console.log(t);break}})})}getAllEasyLoginUsers(){return i(this,null,function*(){let e=l(this.firestore,"users");try{let t=yield d(e),o=[];t.forEach(u=>{o.push(u.data())});let a=["medicodos@yopmail.com","pacientetres@yopmail.com","adminuno@yopmail.com","pacienteuno@yopmail.com","medicouno@yopmail.com","pacientedos@yopmail.com"];return o.filter(u=>a.includes(u.email))}catch(t){throw console.error("Error obteniendo los usuarios:",t),t}})}};r.\u0275fac=function(t){return new(t||r)(s(j),s(E),s(k),s(f))},r.\u0275prov=g({token:r,factory:r.\u0275fac,providedIn:"root"});let n=r;return n})();export{$ as a};
