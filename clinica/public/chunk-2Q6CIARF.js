import{a as _,b as j,c as R,d as G,e as $,f as H}from"./chunk-7SO7NGEO.js";import{b as B,c as z,d as K,e as X}from"./chunk-Q2GRMTA4.js";import{b as N}from"./chunk-7XIEKY6O.js";import{a as O}from"./chunk-XSDBD7LZ.js";import{a as M,b as p,d as T,e as V,h as x,i as P,j as U,m as L,r as k,s as q,t as D}from"./chunk-FSRSBQOR.js";import{H as E,J as w}from"./chunk-6SOKX3XS.js";import{h as A}from"./chunk-2URDVIT7.js";import{Db as F,Eb as b,Mb as s,Ua as m,Va as f,Wb as C,ga as I,kb as c,mb as d,uc as y,vb as r,wb as o,wc as S,xb as g}from"./chunk-TDWWCWZI.js";import{h as v}from"./chunk-DLDOR3YA.js";function W(i,n){i&1&&(r(0,"div",20),s(1," El nombre no puede contener n\xFAmeros "),o())}function Y(i,n){i&1&&(r(0,"div",20),s(1," El apellido no puede contener n\xFAmeros "),o())}function Z(i,n){i&1&&(r(0,"div",20),s(1," Edad inv\xE1lida "),o())}function ee(i,n){i&1&&(r(0,"div",20),s(1," El DNI debe contener 8 n\xFAmeros "),o())}function te(i,n){i&1&&(r(0,"div",20),s(1," La imagen debe ser formato .jpg, .png o .jpeg "),o())}function ie(i,n){i&1&&(r(0,"div"),s(1,"El correo electr\xF3nico es obligatorio."),o())}function re(i,n){i&1&&(r(0,"div"),s(1,"El correo electr\xF3nico no es v\xE1lido."),o())}function oe(i,n){if(i&1&&(r(0,"div",20),c(1,ie,2,0,"div",21)(2,re,2,0,"div",21),o()),i&2){let h=b();m(),d("ngIf",h.registerForm.controls.email.errors==null?null:h.registerForm.controls.email.errors.required),m(),d("ngIf",h.registerForm.controls.email.errors==null?null:h.registerForm.controls.email.errors.email)}}function ne(i,n){i&1&&(r(0,"div",20),s(1," La contrase\xF1a debe contener al menos 8 caracteres. "),o())}function ae(i,n){i&1&&(r(0,"div",20),s(1," La contrase\xF1a no coincide "),o())}var be=(()=>{let n=class n{constructor(t,a,e,l){this.fb=t,this.loginService=a,this.toast=e,this.router=l,this.mainImgLoaded=!1,this.imgsUploaded=!1,this.arrImages=[],this.urls=[],this.validToken=!1,this.storage=z(),this.registerForm=this.fb.group({nombre:["",[p.required,_()]],apellido:["",[p.required,_()]],edad:[0,[p.required,j()]],dni:["",[p.required,R()]],obraSocial:["",[_()]],email:["",[p.required,p.email]],password:["",[p.required,p.minLength(8)]],repeatPassword:["",[p.required,p.minLength(8),$()]],mainImg:["",[p.required,G()]]})}get fc(){return this.registerForm.controls}handleFileInput(t,a){return v(this,null,function*(){let e=this.registerForm?.get("dni")?.value.toString();e||(e=Math.floor(Math.random()*9e7)+1e7);try{let l=t.target;l.files&&l.files.length>0?this.arrImages.push({formControlName:a,dni:e,file:l.files[0]}):this.toast.error("Ups! No se pudo subir la imagen. Intente con otra.")}catch(l){console.log("error al subir la imagen: ",l)}})}uploadFile(){return v(this,null,function*(){if(this.ensureMaxTwoElements(),this.arrImages.length>0&&!this.imgsUploaded){for(let t=0;t<=this.arrImages.length;t++)if(this.arrImages[t]?.file){let a=Math.floor(Math.random()*1e6),e=`users/${this.arrImages[0].dni}/img_${this.arrImages[t].formControlName}_${this.arrImages[t].dni}_${a}`,l=K(this.storage,e);yield X(l,this.arrImages[t].file);let u=yield B(l);this.urls.push({imgField:this.arrImages[t].formControlName,url:u}),this.imgsUploaded=!0}}})}ensureMaxTwoElements(){this.arrImages.length>2?this.arrImages.splice(0,this.arrImages.length-2):this.arrImages.length==2&&this.arrImages.splice(0,1)}checkLoaded(t){this.registerForm?.get(t)?.value!=""&&t==="mainImg"&&(this.mainImgLoaded=!0)}createUser(){return v(this,null,function*(){if(this.isFormValid())try{yield this.uploadFile(),this.loginService.register(this.setNewUser()),this.router.navigateByUrl("/usuarios")}catch(t){console.log(t)}})}setNewUser(){let{nombre:t,apellido:a,dni:e,edad:l,email:u,password:J,obraSocial:Q,mainImg:le}=this.registerForm.value;return this.newUser={nombre:t,apellido:a,dni:e,edad:l,email:u,password:J,obraSocial:Q,mainImg:this.getImgUrl("mainImg"),extraImg:this.getImgUrl("extraImg"),especialidad:[],estado:"habilitado",rol:"admin"},this.newUser}getImgUrl(t){let a=this.urls.find(e=>e.imgField==t);return a?a.url:""}handleCaptchaValidation(t){this.validToken=t}isFormValid(){return this.registerForm.get("nombre")?.valid&&this.registerForm.get("apellido")?.valid&&this.registerForm.get("dni")?.valid&&this.registerForm.get("edad")?.valid&&this.registerForm.get("email")?.valid&&this.registerForm.get("password")?.valid&&this.registerForm.get("repeatPassword")?.valid&&this.registerForm.get("mainImg")?.valid&&this.registerForm.get("obraSocial")?.valid&&this.validToken}};n.\u0275fac=function(a){return new(a||n)(f(k),f(w),f(E),f(A))},n.\u0275cmp=I({type:n,selectors:[["app-alta-admin"]],standalone:!0,features:[C],decls:39,vars:10,consts:[[1,"container-fluid"],[1,"container","mt-4"],[1,"row","justify-content-center"],[1,"col-md-8","col-lg-6","form-container"],[1,"text-center"],[3,"ngSubmit","formGroup"],[1,"form-group"],["type","text","placeholder","Nombre","formControlName","nombre","appAutofocus","",1,"form-control"],["class","text-danger",4,"ngIf"],["type","text","placeholder","Apellido","formControlName","apellido",1,"form-control"],["type","number","placeholder","Edad","formControlName","edad",1,"form-control"],["type","number","placeholder","DNI","formControlName","dni",1,"form-control"],["type","file","formControlName","mainImg",1,"form-control",3,"change"],["type","text","placeholder","Obra Social","formControlName","obraSocial",1,"form-control"],["type","email","placeholder","Email","formControlName","email",1,"form-control"],["type","password","placeholder","Contrase\xF1a","formControlName","password",1,"form-control"],["type","password","placeholder","Repita la contrase\xF1a","formControlName","repeatPassword",1,"form-control"],[3,"captchaValidated"],[1,"login-btns"],["type","submit",1,"btn","btn-success","btn-block",3,"disabled"],[1,"text-danger"],[4,"ngIf"]],template:function(a,e){a&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),s(5,"Alta de Administrador"),o(),r(6,"form",5),F("ngSubmit",function(){return e.createUser()}),r(7,"div",6),g(8,"input",7),c(9,W,2,0,"div",8),o(),r(10,"div",6),g(11,"input",9),c(12,Y,2,0,"div",8),o(),r(13,"div",6),g(14,"input",10),c(15,Z,2,0,"div",8),o(),r(16,"div",6),g(17,"input",11),c(18,ee,2,0,"div",8),o(),r(19,"div",6)(20,"input",12),F("change",function(u){return e.handleFileInput(u,"mainImg"),e.checkLoaded("mainImg")}),o(),c(21,te,2,0,"div",8),o(),r(22,"div",6),g(23,"input",13),o(),r(24,"div",6),g(25,"input",14),c(26,oe,3,2,"div",8),o(),r(27,"div",6),g(28,"input",15),c(29,ne,2,0,"div",8),o(),r(30,"div",6),g(31,"input",16),c(32,ae,2,0,"div",8),o(),r(33,"div",6)(34,"app-captcha",17),F("captchaValidated",function(u){return e.handleCaptchaValidation(u)}),o()(),r(35,"div",18)(36,"div",6)(37,"button",19),s(38,"Crear cuenta"),o()()()()()()()()),a&2&&(m(6),d("formGroup",e.registerForm),m(3),d("ngIf",e.registerForm.controls.nombre.invalid&&(e.registerForm.controls.nombre.dirty||e.registerForm.controls.nombre.touched)),m(3),d("ngIf",e.registerForm.controls.apellido.invalid&&(e.registerForm.controls.apellido.dirty||e.registerForm.controls.apellido.touched)),m(3),d("ngIf",e.registerForm.controls.edad.invalid&&(e.registerForm.controls.edad.dirty||e.registerForm.controls.edad.touched)),m(3),d("ngIf",e.registerForm.controls.dni.invalid&&(e.registerForm.controls.dni.dirty||e.registerForm.controls.dni.touched)),m(3),d("ngIf",e.mainImgLoaded&&e.registerForm.controls.mainImg.invalid&&(e.registerForm.controls.mainImg.dirty||e.registerForm.controls.mainImg.touched)),m(5),d("ngIf",e.registerForm.controls.email.invalid&&(e.registerForm.controls.email.dirty||e.registerForm.controls.email.touched)),m(3),d("ngIf",e.registerForm.controls.password.invalid&&(e.registerForm.controls.password.dirty||e.registerForm.controls.password.touched)),m(3),d("ngIf",e.registerForm.controls.repeatPassword.invalid&&(e.registerForm.controls.repeatPassword.dirty||e.registerForm.controls.repeatPassword.touched)),m(5),d("disabled",!e.isFormValid()))},dependencies:[q,x,M,P,T,V,D,U,L,H,N,S,y,O],styles:['.container-fluid[_ngcontent-%COMP%]{height:110vh;background-color:#6ad8d4;background-image:url("./media/main_fondo-S2RK2XML.png");background-size:250px 250px;background-repeat:repeat;background-position:center;padding:20px}.mt-4[_ngcontent-%COMP%]{background-color:#add8e6;height:102vh}.form-container[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 10px #0000001a;width:100%;max-width:600px;text-align:center;margin:1em}.form-group[_ngcontent-%COMP%]{margin-bottom:1em}h1[_ngcontent-%COMP%]{margin-top:1em;margin-bottom:1em}button[_ngcontent-%COMP%]{margin-top:1em}.login-btns[_ngcontent-%COMP%]{text-align:center}']});let i=n;return i})();export{be as a};
