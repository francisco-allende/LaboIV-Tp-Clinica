import{a as $,b as H,c as W}from"./chunk-HQKNGG3I.js";import{a as O}from"./chunk-YJGBZ2DB.js";import{a as R,b as B,c as j}from"./chunk-E4VBJUJN.js";import{a as N}from"./chunk-JUDL6ATC.js";import{b as V,c as D}from"./chunk-KLT6FR2W.js";import{a as A}from"./chunk-DEDYB2T4.js";import{a as L}from"./chunk-XVUSDMUC.js";import"./chunk-XW2RAFPW.js";import"./chunk-HUVKKSNT.js";import{j as z}from"./chunk-KIGVSZDZ.js";import"./chunk-CC3LA27V.js";import"./chunk-7XIEKY6O.js";import"./chunk-FSRSBQOR.js";import{H as I,J as k}from"./chunk-UUFXAH3U.js";import"./chunk-IX6G3U3V.js";import"./chunk-2URDVIT7.js";import{Ab as f,Db as _,Eb as c,Mb as l,Nb as u,Ua as d,Va as h,Wb as b,Zb as E,_b as w,ga as x,kb as S,mb as v,qa as p,ra as m,rb as F,sb as M,tb as y,ub as P,vb as n,wb as o,xb as T}from"./chunk-TDWWCWZI.js";import{h as C}from"./chunk-DLDOR3YA.js";function q(r,a){if(r&1&&T(0,"app-spinner",3),r&2){let t=c();v("loading",t.loading)}}function G(r,a){r&1&&(n(0,"td",10),l(1,"No se encontraron resultados"),o())}function J(r,a){if(r&1){let t=f();n(0,"button",16),_("click",function(){p(t);let i=c().$implicit,s=c(3);return m(s.changeState(i,"cancelado"))}),l(1," Cancelar "),o()}}function Q(r,a){if(r&1){let t=f();n(0,"button",17),_("click",function(){p(t);let i=c().$implicit,s=c(3);return m(s.showMotivo(i.comentario))}),l(1," Ver motivo "),o()}}function Y(r,a){if(r&1){let t=f();n(0,"tr",6)(1,"td"),l(2),E(3,"capitalizeFirstLetterPipe"),o(),n(4,"td"),l(5),E(6,"setFechaWithSlashes"),o(),n(7,"td"),l(8),E(9,"horariosAmPmFormat"),o(),n(10,"td",12),_("click",function(){let i=p(t).$implicit,s=c(3);return m(s.setFilter("especialista",i.especialistaId))}),l(11),o(),n(12,"td",12),_("click",function(){let i=p(t).$implicit,s=c(3);return m(s.setFilter("especialidad",i.especialidad))}),l(13),o(),n(14,"td"),l(15),o(),n(16,"td",13),l(17),o(),n(18,"td")(19,"div",14),S(20,J,2,0,"button",15)(21,Q,2,0),o()()()}if(r&2){let t=a.$implicit,e=c(3);d(2),u(w(3,8,t.fecha.dayName)),d(3),u(w(6,10,t.fecha.fecha)),d(3),u(w(9,12,t.fecha.timeSlot.time)),d(3),u(e.userMap[t.especialistaId]),d(2),u(t.especialidad),d(2),u(e.userMap[t.pacienteId]),d(2),u(t.estado),d(3),F(20,t.estado=="pendiente"?20:21)}}function Z(r,a){if(r&1&&y(0,Y,22,14,"tr",6,M),r&2){let t=c(2);P(t.pagedTurnos)}}function ee(r,a){if(r&1){let t=f();n(0,"app-listado-filtros",4),_("filterApplied",function(i){p(t);let s=c();return m(s.onFilterApplied(i))})("filtersCleared",function(){p(t);let i=c();return m(i.onFiltersCleared())}),o(),n(1,"table",5)(2,"thead")(3,"tr",6)(4,"th",7),l(5,"D\xEDa"),o(),n(6,"th",7),l(7,"Fecha"),o(),n(8,"th",7),l(9,"Horario"),o(),n(10,"th",7),l(11,"Especialista"),o(),n(12,"th",7),l(13,"Especialidad"),o(),n(14,"th",7),l(15,"Paciente"),o(),n(16,"th",8),l(17,"Estado"),o(),n(18,"th",9),l(19,"Modificar Estado"),o()()(),n(20,"tbody"),S(21,G,2,0,"td",10)(22,Z,2,0),o()(),n(23,"app-paginacion",11),_("pageChanged",function(i){p(t);let s=c();return m(s.setPage(i))}),o()}if(r&2){let t=c();v("currentRol",t.currentRol)("turnos",t.turnos)("filteredTurnos",t.filteredTurnos)("userMap",t.userMap)("especialidadFilter",t.especialidadFilter)("especialistaFilter",t.especialistaFilter),d(21),F(21,(t.pagedTurnos==null?null:t.pagedTurnos.length)===0?21:22),d(2),v("currentPage",t.currentPage)("totalPages",t.totalPages)}}var K=(()=>{let a=class a{constructor(e,i,s,g,U){this.userService=e,this.loginService=i,this.turnoService=s,this.toast=g,this.dialog=U,this.loading=!0,this.currentRol="admin",this.turnos=[],this.filteredTurnos=[],this.userMap={},this.currentPage=1,this.pageSize=10,this.especialidadFilter="",this.especialistaFilter=""}ngOnInit(){this.turnoService.getAllTurnos().subscribe(e=>{this.turnos=e,this.filteredTurnos=this.turnos,this.getData()})}getData(){return C(this,null,function*(){try{if(this.turnos&&this.turnos.length>0)for(let e of this.turnos)this.userMap[e.especialistaId]||(this.userMap[e.especialistaId]=yield this.userService.getNameAndSurnameByEmail(e.especialistaId)),this.userMap[e.pacienteId]||(this.userMap[e.pacienteId]=yield this.userService.getNameAndSurnameByEmail(e.pacienteId))}catch(e){console.log(e)}finally{this.loading=!1}})}setFilter(e,i){e==="especialidad"?this.especialidadFilter=i:e==="especialista"&&(this.especialistaFilter=this.userMap[i])}onFilterApplied(e){this.especialidadFilter=e.especialidadFilter,this.especialistaFilter=e.especialistaFilter,this.applyFilters()}onFiltersCleared(){this.especialidadFilter="",this.especialistaFilter="",this.filteredTurnos=this.turnos}applyFilters(){this.filteredTurnos=this.turnos?.filter(e=>{let i=this.especialidadFilter?e.especialidad.includes(this.especialidadFilter):!0,s=this.especialistaFilter?this.userMap[e.especialistaId].includes(this.especialistaFilter):!0;return i&&s})}changeState(e,i){return C(this,null,function*(){this.dialog.open($,{width:"400px",data:{motivo:""}}).afterClosed().subscribe(g=>C(this,null,function*(){g&&(e.estado=i,e.comentario=g,yield this.turnoService.update(e))}))})}showMotivo(e){this.dialog.open(H,{width:"400px",data:{motivo:e}})}get pagedTurnos(){let e=(this.currentPage-1)*this.pageSize;return this.filteredTurnos?.slice(e,e+this.pageSize)}get totalPages(){return this.filteredTurnos?Math.ceil(this.filteredTurnos.length/this.pageSize):0}setPage(e){this.currentPage=e}};a.\u0275fac=function(i){return new(i||a)(h(L),h(k),h(N),h(I),h(z))},a.\u0275cmp=x({type:a,selectors:[["app-listar-turnos"]],standalone:!0,features:[b],decls:5,vars:1,consts:[[1,"container-fluid"],[1,"container","mt-4"],[1,"row","container"],[3,"loading"],[3,"filterApplied","filtersCleared","currentRol","turnos","filteredTurnos","userMap","especialidadFilter","especialistaFilter"],[1,"table","table-striped","table-light","container"],[1,"text-center"],["scope","col"],["scope","col",2,"width","120px"],["scope","col",1,"td-modify-state"],["colspan","6",1,"td-no-results"],[3,"pageChanged","currentPage","totalPages"],[1,"td-clickeable",3,"click"],[2,"width","120px"],[1,"td-modify-state"],[1,"btn","btn-dark"],[1,"btn","btn-dark",3,"click"],[1,"btn","btn-secondary",3,"click"]],template:function(i,s){i&1&&(n(0,"div",0)(1,"div",1)(2,"div",2),S(3,q,1,1,"app-spinner",3)(4,ee,24,9),o()()()),i&2&&(d(3),F(3,s.loading?3:4))},dependencies:[A,W,O,j,B,R],styles:['.container-fluid[_ngcontent-%COMP%]{height:90vh;background-color:#6ad8d4;background-image:url("./media/main_fondo-S2RK2XML.png");background-size:250px 250px;background-repeat:repeat;background-position:center;padding:20px}.mt-4[_ngcontent-%COMP%]{background-color:#add8e6;height:800px}table[_ngcontent-%COMP%]{margin-top:1em}.td-modify-state[_ngcontent-%COMP%]{width:250px}.td-clickeable[_ngcontent-%COMP%]:hover{opacity:.6;cursor:pointer}.td-no-results[_ngcontent-%COMP%]{background-color:#fff;text-align:center;font-size:medium;padding-top:1em;padding-bottom:1em}']});let r=a;return r})();var xe=(()=>{let a=class a{};a.\u0275fac=function(i){return new(i||a)},a.\u0275cmp=x({type:a,selectors:[["app-turnos-container"]],standalone:!0,features:[b],decls:4,vars:0,consts:[[1,"container-fluid","m-0","p-0"]],template:function(i,s){i&1&&(n(0,"div",0),T(1,"app-navbar")(2,"app-listar-turnos")(3,"app-footer"),o())},dependencies:[V,D,K]});let r=a;return r})();export{xe as TurnosContainerComponent};
