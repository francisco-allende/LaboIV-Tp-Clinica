import{a as nt}from"./chunk-S5EKIQAW.js";import{a as w}from"./chunk-GSNWQ4FR.js";import"./chunk-AT26J2S3.js";import{a as S}from"./chunk-JUDL6ATC.js";import{c as D}from"./chunk-WB4RW6JM.js";import{a as z,b as G,c as A}from"./chunk-KLT6FR2W.js";import"./chunk-XVUSDMUC.js";import"./chunk-CC3LA27V.js";import"./chunk-7XIEKY6O.js";import{a as V,d as Q,g as R,s as Z}from"./chunk-FSRSBQOR.js";import{H as F,J as $}from"./chunk-UUFXAH3U.js";import"./chunk-IX6G3U3V.js";import"./chunk-2URDVIT7.js";import{Db as v,Ib as _,Jb as M,Kb as P,Mb as m,Sa as B,Sb as I,Tb as x,Ua as l,Ub as L,Va as u,Wb as b,ga as f,kb as E,mb as h,rb as j,vb as d,wb as c,xb as g}from"./chunk-TDWWCWZI.js";import"./chunk-FK6H3RFT.js";import{f as at,h as N}from"./chunk-DLDOR3YA.js";var W=at(nt());var q=(()=>{let o=class o{constructor(e){this.loginServicve=e,this.logs=[]}ngOnInit(){this.getData()}getData(){return N(this,null,function*(){this.logs=yield this.loginServicve.getAllLogs()})}descargarCSV(){let a=["fecha,userEmail",...this.getCSVFormatData()(this.logs).map(n=>`${n.fecha},${n.userEmail}`)];W.saveAs(this.getBlob(a),`${this.getFileName()}.csv`)}getCSVFormatData(){return e=>e.map(t=>({fecha:this.getFormattedDate(t.fecha)||"-",userEmail:t.userEmail||"-"}))}getFormattedDate(e){let t=new Date(e.toDate()),a=t.getDate(),n=t.getMonth()+1,i=t.getFullYear(),s=t.getHours(),y=t.getMinutes(),p=t.getSeconds(),C=a<10?`0${a}`:a,T=n<10?`0${n}`:n,k=s<10?`0${s}`:s,tt=y<10?`0${y}`:y,et=p<10?`0${p}`:p;return`${C}/${T}/${i} ${k}:${tt}:${et}`}getFileName(){let e=new Date;return`Logs_Clinica_San_Francisco_${e.getFullYear()}-${this.padZero(e.getMonth()+1)}-${this.padZero(e.getDate())}_${this.padZero(e.getHours())}-${this.padZero(e.getMinutes())}-${this.padZero(e.getSeconds())}`}getBlob(e){let t=e.join(`
`);return new Blob([t],{type:"text/csv;charset=utf-8"})}padZero(e){return e<10?`0${e}`:`${e}`}};o.\u0275fac=function(t){return new(t||o)(u($))},o.\u0275cmp=f({type:o,selectors:[["app-logs"]],standalone:!0,features:[b],decls:8,vars:1,consts:[[1,"container-fluid"],[1,"d-flex","justify-content-center","btn-container"],["appCursorPointer","",1,"log-card",3,"click"],[1,"image-container"],["alt","Logs",1,"log-image",3,"src"],[1,"overlay"],[1,"log-name"]],template:function(t,a){t&1&&(d(0,"div",0)(1,"div",1)(2,"div",2),v("click",function(){return a.descargarCSV()}),d(3,"div",3),g(4,"img",4),d(5,"div",5)(6,"div",6),m(7,"Descargar Logs"),c()()()()()()),t&2&&(l(4),h("src","../../../../assets/log.png",B))},dependencies:[z],styles:['.btn-container[_ngcontent-%COMP%]{background-color:transparent;margin:1em}.log-image[_ngcontent-%COMP%]{border-radius:50%;width:200px;height:200px;object-fit:cover;display:block;background-color:#2fa22f}.overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-direction:column;background-color:#0006;color:#fff;opacity:0;transition:opacity .3s ease}.image-container[_ngcontent-%COMP%]:hover   .overlay[_ngcontent-%COMP%]{opacity:1}.log-name[_ngcontent-%COMP%]{margin-bottom:.5em;font-size:1.2em}.log-card[_ngcontent-%COMP%]{position:relative;margin:1em}.image-container[_ngcontent-%COMP%]{position:relative;display:inline-block}.container-fluid[_ngcontent-%COMP%]{height:35vh;background-color:#6ad8d4;background-image:url("./media/main_fondo-S2RK2XML.png");background-size:250px 250px;background-repeat:repeat;background-position:center;padding:20px}']});let r=o;return r})();var H=(()=>{let o=class o{constructor(e,t){this.toast=e,this.turnosService=t,this.barChartLabels=[],this.barChartData=[{data:[],label:"Cantidad de Turnos seg\xFAn especialidad"}],this.barChartOptions={responsive:!0,width:"400px",height:"200px",backgroundColor:"#0cb7f2"},this.turnos=[]}ngOnInit(){this.turnosService.getAllTurnos().subscribe(e=>{this.turnos=e,this.filterData()})}filterData(){let e=this.turnos.reduce((t,a)=>(a.especialidad&&(t[a.especialidad]=(t[a.especialidad]||0)+1),t),{});this.updateChart(e)}updateChart(e){let t=Object.entries(e).sort((a,n)=>a[1]-n[1]);this.barChartLabels=t.map(a=>a[0]),this.barChartData=[{data:t.map(a=>a[1]),label:"Cantidad de Turnos seg\xFAn especialidad"}]}downloadPDF(){try{let e=new w,t=this.chart?.toBase64Image();t?(e.addImage(t,"PNG",10,10,180,160),e.save("grafico_turnos_por_especialidad.pdf")):this.toast.error("No se puedo descargar el PDF")}catch(e){console.log(e)}}};o.\u0275fac=function(t){return new(t||o)(u(F),u(S))},o.\u0275cmp=f({type:o,selectors:[["app-graf-turnos-por-especialidad"]],viewQuery:function(t,a){if(t&1&&_(D,5),t&2){let n;M(n=P())&&(a.chart=n.first)}},standalone:!0,features:[b],decls:7,vars:3,consts:[[1,"container-fluid"],[1,"container","mt-4"],[1,"row","container","graph-container"],["baseChart","","type","bar",3,"datasets","labels","options"],[1,"btn","btn-success","btn-pdf",3,"click"]],template:function(t,a){t&1&&(d(0,"div",0)(1,"div",1)(2,"div",2),g(3,"canvas",3)(4,"br"),d(5,"button",4),v("click",function(){return a.downloadPDF()}),m(6,"Descargar"),c()()()()),t&2&&(l(3),h("datasets",a.barChartData)("labels",a.barChartLabels)("options",a.barChartOptions))},dependencies:[D],styles:['.container-fluid[_ngcontent-%COMP%]{height:85vh;background-color:#6ad8d4;background-image:url("./media/main_fondo-S2RK2XML.png");background-size:250px 250px;background-repeat:repeat;background-position:center;padding:20px}.graph-container[_ngcontent-%COMP%]{background-color:#fff;padding-bottom:1em}.mt-4[_ngcontent-%COMP%]{height:800px}.btn-pdf[_ngcontent-%COMP%]{margin-top:1em}']});let r=o;return r})();var U=(()=>{let o=class o{constructor(e,t){this.toast=e,this.turnosService=t,this.barChartLabels=[],this.barChartData=[{data:[],label:"Cantidad de Turnos por d\xEDa"}],this.barChartOptions={responsive:!0,width:"400px",height:"200px",backgroundColor:"#ffa420",fill:!0},this.turnos=[]}ngOnInit(){this.turnosService.getAllTurnos().subscribe(e=>{this.turnos=e,this.filterData()})}filterData(){let e={};this.turnos.forEach(t=>{let a=t.fecha.fecha,n=t.fecha.dayName;e[n]||(e[n]=[]);let i=e[n].find(s=>s.fecha===a);i?i.cantidad++:e[n].push({fecha:a,cantidad:1})}),this.updateChart(e)}orderByDate(e,t){let a=/^(\d{2})-(\d{2})-(\d{4})$/,n=e.match(a),i=n?parseInt(n[1],10):0,s=n?parseInt(n[2],10):0,y=n?parseInt(n[3],10):0,p=t.match(a),C=p?parseInt(p[1],10):0,T=p?parseInt(p[2],10):0,k=p?parseInt(p[3],10):0;return y!==k?y-k:s!==T?s-T:i-C}updateChart(e){let t=new Set,a=Object.entries(e).map(([i,s])=>{let y=s.map(C=>C.fecha),p=s.map(C=>C.cantidad);return s.forEach(C=>t.add(C.fecha)),{labels:y,data:p}}),n=Array.from(t).sort((i,s)=>this.orderByDate(i,s));this.barChartLabels=n,this.barChartData=[{data:this.fillDataWithZero(n,a.flatMap(i=>i.data),n),label:"Turnos por d\xEDa"}]}fillDataWithZero(e,t,a){return a.map(n=>{let i=e.indexOf(n);return i!==-1?t[i]:0})}downloadPDF(){try{let e=new w,t=this.chart?.toBase64Image();t?(e.addImage(t,"PNG",10,10,180,160),e.save("grafico_turnos_por_dia.pdf")):this.toast.error("No se puedo descargar el PDF")}catch(e){console.log(e)}}};o.\u0275fac=function(t){return new(t||o)(u(F),u(S))},o.\u0275cmp=f({type:o,selectors:[["app-graph-turnos-por-dia"]],viewQuery:function(t,a){if(t&1&&_(D,5),t&2){let n;M(n=P())&&(a.chart=n.first)}},standalone:!0,features:[b],decls:7,vars:3,consts:[[1,"container-fluid"],[1,"container","mt-4"],[1,"row","container","graph-container"],["baseChart","","type","bar",3,"datasets","labels","options"],[1,"btn","btn-success","btn-pdf",3,"click"]],template:function(t,a){t&1&&(d(0,"div",0)(1,"div",1)(2,"div",2),g(3,"canvas",3)(4,"br"),d(5,"button",4),v("click",function(){return a.downloadPDF()}),m(6,"Descargar"),c()()()()),t&2&&(l(3),h("datasets",a.barChartData)("labels",a.barChartLabels)("options",a.barChartOptions))},dependencies:[D],styles:['.container-fluid[_ngcontent-%COMP%]{height:85vh;background-color:#6ad8d4;background-image:url("./media/main_fondo-S2RK2XML.png");background-size:250px 250px;background-repeat:repeat;background-position:center;padding:20px}.graph-container[_ngcontent-%COMP%]{background-color:#fff;padding-bottom:1em}.mt-4[_ngcontent-%COMP%]{height:800px}.btn-pdf[_ngcontent-%COMP%]{margin-top:1em}']});let r=o;return r})();function ot(r,o){r&1&&(d(0,"label",4),m(1,"\u25CF Resultados del 1ro del mes actual al 1ro del mes siguiente"),c())}var J=(()=>{let o=class o{constructor(e,t){this.toast=e,this.turnosService=t,this.filterByFinalizados=!1,this.label="",this.pdfName="",this.barChartLabels=[],this.barChartData=[{data:[],label:this.label}],this.barChartOptions={responsive:!0,width:"400px",height:"200px",backgroundColor:"lightgreen",scales:{y:{beginAtZero:!0}}},this.contadorVeces=0,this.isFirstTime=!0,this.turnos=[];let{start:a,end:n}=this.getThisMonthRange();this.startDate=a,this.endDate=n}ngOnInit(){this.turnosService.getAllTurnos().subscribe(e=>{this.turnos=e,this.filterData()})}getThisMonthRange(){let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),a=new Date(e.getFullYear(),e.getMonth()+1,1);return{start:t,end:a}}parseDate(e){let[t,a,n]=e.split("-").map(i=>parseInt(i,10));return!isNaN(t)&&!isNaN(a)&&!isNaN(n)?new Date(n,a-1,t):new Date("min")}filterData(){let e=this.startDate?new Date(this.startDate):new Date("1970-01-01"),t=this.endDate?new Date(this.endDate):new Date,a=this.turnos.filter(i=>{let s=this.parseDate(i.fecha.fecha);return s>=e&&s<=t});this.filterByFinalizados&&(a=a.filter(i=>i.estado=="finalizado"));let n=a.reduce((i,s)=>(s.especialistaId&&(i[s.especialistaId]=(i[s.especialistaId]||0)+1),i),{});this.showInitialMessage(),this.updateChart(n)}updateChart(e){let t=Object.entries(e).sort((a,n)=>a[1]-n[1]);this.barChartLabels=t.map(a=>a[0]),this.barChartData=[{data:t.map(a=>a[1]),label:this.label}],this.chart?.update()}downloadPDF(){try{let e=new w,t=this.chart?.toBase64Image();t?(e.addImage(t,"PNG",10,10,180,160),e.save(this.pdfName)):this.toast.error("No se pudo descargar el PDF")}catch(e){console.log(e)}}showInitialMessage(){this.isFirstTime&&(this.contadorVeces++,this.contadorVeces>1&&(this.isFirstTime=!1))}};o.\u0275fac=function(t){return new(t||o)(u(F),u(S))},o.\u0275cmp=f({type:o,selectors:[["app-graph-turnos-por-medico-lapso-tiempo"]],viewQuery:function(t,a){if(t&1&&_(D,5),t&2){let n;M(n=P())&&(a.chart=n.first)}},inputs:{filterByFinalizados:"filterByFinalizados",label:"label",pdfName:"pdfName"},standalone:!0,features:[b],decls:17,vars:6,consts:[[1,"container-fluid"],[1,"container","mt-4"],[1,"row","container","graph-container"],[1,"d-flex","justify-content-evenly"],[1,"form-label"],["for","startDate",1,"form-label"],["type","date","id","startDate",1,"form-control",3,"ngModelChange","ngModel"],["for","endDate",1,"form-label"],["type","date","id","endDate",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click"],["baseChart","","type","bar",3,"datasets","labels","options"],[1,"btn","btn-success","btn-pdf",3,"click"]],template:function(t,a){t&1&&(d(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),E(4,ot,2,0,"label",4),d(5,"label",5),m(6,"Fecha de Inicio:"),c(),d(7,"input",6),L("ngModelChange",function(i){return x(a.startDate,i)||(a.startDate=i),i}),c(),d(8,"label",7),m(9,"Fecha de Fin:"),c(),d(10,"input",8),L("ngModelChange",function(i){return x(a.endDate,i)||(a.endDate=i),i}),c(),d(11,"button",9),v("click",function(){return a.filterData()}),m(12,"Filtrar"),c()(),g(13,"canvas",10)(14,"br"),d(15,"button",11),v("click",function(){return a.downloadPDF()}),m(16,"Descargar"),c()()()()),t&2&&(l(4),j(4,a.isFirstTime?4:-1),l(3),I("ngModel",a.startDate),l(3),I("ngModel",a.endDate),l(3),h("datasets",a.barChartData)("labels",a.barChartLabels)("options",a.barChartOptions))},dependencies:[D,Z,V,Q,R],styles:['.container-fluid[_ngcontent-%COMP%]{height:85vh;background-color:#6ad8d4;background-image:url("./media/main_fondo-S2RK2XML.png");background-size:250px 250px;background-repeat:repeat;background-position:center;padding:20px}.graph-container[_ngcontent-%COMP%]{background-color:#fff;padding-top:1em;padding-bottom:1em}.mt-4[_ngcontent-%COMP%]{height:800px}.btn-pdf[_ngcontent-%COMP%]{margin-top:1em}.form-label[_ngcontent-%COMP%]{padding-top:.7em}.form-control[_ngcontent-%COMP%]{width:200px}']});let r=o;return r})();var Mt=(()=>{let o=class o{constructor(){this.filterByFinalizados=!1,this.label="",this.pdfName=""}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=f({type:o,selectors:[["app-graficos-container"]],standalone:!0,features:[b],decls:8,vars:6,consts:[[1,"container-fluid","m-0","p-0"],[3,"filterByFinalizados","label","pdfName"]],template:function(t,a){t&1&&(d(0,"div",0),g(1,"app-navbar")(2,"app-graf-turnos-por-especialidad")(3,"app-graph-turnos-por-dia")(4,"app-graph-turnos-por-medico-lapso-tiempo",1)(5,"app-graph-turnos-por-medico-lapso-tiempo",1)(6,"app-logs")(7,"app-footer"),c()),t&2&&(l(4),h("filterByFinalizados",!1)("label","Cantidad de Turnos por m\xE9dico seg\xFAn lapso de tiempo")("pdfName","grafico_turnos_por_medico_segun_lapso_tiempo.pdf"),l(),h("filterByFinalizados",!0)("label","Cantidad de Turnos finalizados por m\xE9dico seg\xFAn lapso de tiempo")("pdfName","grafico_turnos_finalizados_por_medico_segun_lapso_tiempo.pdf"))},dependencies:[q,U,J,G,A,H]});let r=o;return r})();export{Mt as GraficosContainerComponent};
