import"./chunk-2Q6CIARF.js";import{a as z,b as B}from"./chunk-W57UCMC7.js";import{a as H}from"./chunk-ZRN5QWZ6.js";import"./chunk-ZGC33XT2.js";import"./chunk-E4VBJUJN.js";import{a as X}from"./chunk-S5EKIQAW.js";import"./chunk-GSNWQ4FR.js";import{a as R}from"./chunk-AT26J2S3.js";import{a as j}from"./chunk-6ODF7MUU.js";import{b as M,c as A}from"./chunk-TEBHIWMK.js";import{a as N}from"./chunk-DEDYB2T4.js";import{a as L}from"./chunk-NDYST4XC.js";import"./chunk-7SO7NGEO.js";import{j as O}from"./chunk-KIGVSZDZ.js";import"./chunk-CC3LA27V.js";import"./chunk-Q2GRMTA4.js";import"./chunk-7XIEKY6O.js";import"./chunk-XSDBD7LZ.js";import"./chunk-FSRSBQOR.js";import{H as y}from"./chunk-6SOKX3XS.js";import"./chunk-IX6G3U3V.js";import"./chunk-2URDVIT7.js";import{Ab as C,Db as _,Eb as c,Mb as d,Ob as x,Pb as k,Sa as w,Ua as m,Va as b,Wb as T,ga as $,kb as v,mb as S,qa as p,ra as u,rb as g,sb as V,tb as F,ub as D,vb as l,wb as r,xb as h}from"./chunk-TDWWCWZI.js";import"./chunk-FK6H3RFT.js";import{f as K,h as f}from"./chunk-DLDOR3YA.js";var P=K(X());function q(o,s){if(o&1){let n=C();l(0,"div",14),_("click",function(){p(n);let t=c().$implicit,a=c(2);return u(a.selectUser(t))}),h(1,"img",15),l(2,"button",16),_("click",function(){p(n);let t=c().$implicit,a=c(2);return u(a.toggleImage(t))}),d(3,"Cambiar Imagen"),r()()}if(o&2){let n=c().$implicit,e=c(2);m(),S("src",e.selectedImages[n.email],w)}}function G(o,s){if(o&1){let n=C();l(0,"div",17),_("click",function(){p(n);let t=c().$implicit,a=c(2);return u(a.selectUser(t))}),h(1,"img",15),r()}if(o&2){let n=c().$implicit;m(),S("src",n.mainImg,w)}}function J(o,s){if(o&1&&(l(0,"p",9)(1,"strong"),d(2,"Obra Social:"),r(),d(3),r()),o&2){let n=c().$implicit;m(3),x(" ",n.obraSocial,"")}}function Q(o,s){if(o&1&&(l(0,"p",9)(1,"strong"),d(2,"Especialidad/es:"),r(),d(3),r()),o&2){let n=c().$implicit;m(3),x(" ",n.especialidad,"")}}function W(o,s){if(o&1){let n=C();l(0,"button",18),_("click",function(){p(n);let t=c().$implicit,a=c(2);return u(a.changeState(t,"habilitado"))}),d(1," Habilitar "),r()}}function ee(o,s){if(o&1){let n=C();l(0,"button",19),_("click",function(){p(n);let t=c().$implicit,a=c(2);return u(a.changeState(t,"deshabilitado"))}),d(1," Desabilitar "),r()}}function te(o,s){if(o&1){let n=C();l(0,"button",20),_("click",function(){p(n);let t=c().$implicit,a=c(2);return u(a.verHistoriaClinica(t))}),d(1," Ver Hist. Clinica "),r()}}function ie(o,s){if(o&1){let n=C();l(0,"button",21),_("click",function(){p(n);let t=c().$implicit,a=c(2);return u(a.exportUserToCSV(t))}),d(1," CSV "),l(2,"mat-icon",22),d(3,"download"),r()()}}function ne(o,s){if(o&1&&(l(0,"div",4),v(1,q,4,1,"div",7)(2,G,2,1),l(3,"div",8)(4,"p",9)(5,"strong"),d(6,"Nombre completo:"),r(),d(7),r(),l(8,"p",9)(9,"strong"),d(10,"DNI:"),r(),d(11),r(),l(12,"p",9)(13,"strong"),d(14,"Email:"),r(),d(15),r(),l(16,"p",9)(17,"strong"),d(18,"Rol:"),r(),d(19),r(),v(20,J,4,1,"p",9)(21,Q,4,1,"p",9),l(22,"p",9)(23,"strong"),d(24,"Estado:"),r(),d(25),r(),l(26,"div",10),v(27,W,2,0,"button",11)(28,ee,2,0)(29,te,2,0,"button",12)(30,ie,4,0,"button",13),r()()()),o&2){let n=s.$implicit,e=c(2);m(),g(1,n.rol==="paciente"?1:2),m(6),k(" ",n.nombre," ",n.apellido,""),m(4),x(" ",n.dni," "),m(4),x(" ",n.email,""),m(4),x(" ",n.rol,""),m(),g(20,n.rol==="paciente"?20:-1),m(),g(21,n.rol==="especialista"?21:-1),m(4),x(" ",n.estado,""),m(2),g(27,n.estado=="pendiente"||n.estado=="deshabilitado"?27:n.estado=="habilitado"?28:-1),m(2),g(29,n.rol=="paciente"?29:-1),m(),g(30,e.isUserSelected(n)?30:-1)}}function oe(o,s){if(o&1){let n=C();F(0,ne,31,12,"div",4,V),l(2,"button",5),_("click",function(){p(n);let t=c();return u(t.exportAllToCSV())}),d(3,"Exportar listado a CSV"),r(),l(4,"app-paginacion",6),_("pageChanged",function(t){p(n);let a=c();return u(a.setPage(t))}),r()}if(o&2){let n=c();D(n.pagedUsers),m(4),S("currentPage",n.currentPage)("totalPages",n.totalPages)}}var Z=(()=>{let s=class s{constructor(e,t,a,i){this.usersService=e,this.turnosService=t,this.toast=a,this.dialog=i,this.users=[],this.loading=!0,this.currentPage=1,this.pageSize=6,this.selectedImages={}}ngOnInit(){this.getData()}getData(){return f(this,null,function*(){try{this.users=yield this.usersService.getAllUsers(),this.setPacientesImg()}catch(e){console.log(e)}finally{this.loading=!1}})}setPacientesImg(){this.users.forEach(e=>{e.rol=="paciente"&&(this.selectedImages[e.email]=e.mainImg)})}changeState(e,t){return f(this,null,function*(){e.estado=t,yield this.usersService.update(e)})}get pagedUsers(){let e=(this.currentPage-1)*this.pageSize;return this.users?.slice(e,e+this.pageSize)}get totalPages(){return this.users?Math.ceil(this.users.length/this.pageSize):0}setPage(e){this.currentPage=e}verHistoriaClinica(e){this.dialog.open(z,{width:"600px",data:e.historiaClinica})}exportAllToCSV(){let a=["nombre,apellido,edad,dni,email,rol,obraSocial,especialidad,estado",...this.getCSVFormatData()(this.users).map(i=>`${i.nombre},${i.apellido},${i.edad},${i.dni},${i.email},${i.rol},${i.obraSocial},${i.especialidad},${i.estado}`)];P.saveAs(this.getBlob(a),`${this.getFileName()}.csv`)}exportUserToCSV(e){return f(this,null,function*(){let t=yield this.getCSVUserData(e);if(!t||t.length<1){this.toast.info("Este usuario no posee turnos");return}let a=["Id,NombreUsuarioSeleccionado,MedicoAtendedor,PacienteAtendido,FechaTurno,DiaTurno,HoraTurno,EspecialidadTurno,ComentarioTurno,ReseniaTurno,EstadoTurno,Altura,Peso,Temperatura,Presion,DatosDinamicos,",...t.map(i=>`${i.Id},${i.NombreUsuarioSeleccionado},${i.MedicoAtendedor},${i.PacienteAtendido},${i.FechaTurno},${i.DiaTurno},${i.HoraTurno},${i.EspecialidadTurno},${i.ComentarioTurno},${i.ReseniaTurno},${i.EstadoTurno},${i.AlturaPaciente},${i.PesoPaciente},${i.TemperaturaPaciente},${i.PresionPaciente},${i.DatosDinamicosPaciente},${i.ObraSocial||"-"},${i.EspecialidadUsuario||"-"}`)];P.saveAs(this.getBlob(a),`${this.getFileName(e)}.csv`)})}getCSVUserData(e){return f(this,null,function*(){let t=[];return e.rol=="paciente"?t=yield this.turnosService.getTurnosFromPaciente(e.email):e.rol=="especialista"&&(t=yield this.turnosService.getTurnosFromEspecialista(e.email)),t&&t.length>0?yield Promise.all(t.map(i=>f(this,null,function*(){let E=yield this.usersService.getNameAndSurnameByEmail(i.especialistaId),U=yield this.usersService.getNameAndSurnameByEmail(i.pacienteId);return console.log("medico: ",E," paceinte: ",U),{Id:i.id,NombreUsuarioSeleccionado:`${e.nombre} ${e.apellido}`,MedicoAtendedor:E,PacienteAtendido:U,FechaTurno:i.fecha.fecha,DiaTurno:i.fecha.dayName,HoraTurno:i.fecha.timeSlot.time,EspecialidadTurno:i.especialidad,ComentarioTurno:i.comentario,ReseniaTurno:i.resenia,EstadoTurno:i.estado,AlturaPaciente:i.historiaClinica?.altura||"-",PesoPaciente:i.historiaClinica?.peso||"-",TemperaturaPaciente:i.historiaClinica?.temperatura||"-",PresionPaciente:i.historiaClinica?.presion||"-",DatosDinamicosPaciente:i.historiaClinica?.datosDinamicos?i.historiaClinica.datosDinamicos.map(I=>`${I.key}: ${I.value}`).join(", "):"-"}}))):[]})}getCSVFormatData(){return e=>e.map(t=>({nombre:t.nombre||"-",apellido:t.apellido||"-",edad:t.edad||"-",dni:t.dni||"-",email:t.email||"-",rol:t.rol||"-",obraSocial:t.obraSocial||"-",especialidad:t.especialidad?t.especialidad.join(", "):"-",estado:t.estado||"-"}))}getFileName(e){let t=new Date,a="";return e?a=`Turnos_${e.nombre}_${e.apellido}`:a="Listado_usuarios",`${a}_Clinica_San_Francisco_${t.getFullYear()}-${this.padZero(t.getMonth()+1)}-${this.padZero(t.getDate())}_${this.padZero(t.getHours())}-${this.padZero(t.getMinutes())}-${this.padZero(t.getSeconds())}`}getBlob(e){let t=e.join(`
`);return new Blob([t],{type:"text/csv;charset=utf-8"})}padZero(e){return e<10?`0${e}`:`${e}`}toggleImage(e){this.selectedImages[e.email]===e.mainImg?e.extraImg&&(this.selectedImages[e.email]=e.extraImg):this.selectedImages[e.email]=e.mainImg}selectUser(e){this.selectedUser=e}isUserSelected(e){return this.selectedUser===e}};s.\u0275fac=function(t){return new(t||s)(b(L),b(j),b(y),b(O))},s.\u0275cmp=$({type:s,selectors:[["app-listado-usuarios"]],standalone:!0,features:[T],decls:5,vars:2,consts:[[1,"container-fluid"],[1,"container","mt-4"],[1,"row","container"],[3,"loading"],[1,"user-card"],[1,"btn","btn-success","btn-csv",3,"click"],[3,"pageChanged","currentPage","totalPages"],[1,"d-flex","flex-column","align-items-center","select-user",2,"margin-bottom","1em"],[1,"user-details"],[1,"user-data"],[1,"btn-container","d-flex","justify-content-evenly","align-items-center"],[1,"btn","btn-success","enabled"],[1,"btn","btn-primary","text-center"],[1,"btn","btn-success"],[1,"d-flex","flex-column","align-items-center","select-user",2,"margin-bottom","1em",3,"click"],["alt","User Image","appRoundedImg","",1,"user-image",3,"src"],[1,"btn","btn-dark","text-center",3,"click"],[1,"select-user",3,"click"],[1,"btn","btn-success","enabled",3,"click"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-primary","text-center",3,"click"],[1,"btn","btn-success",3,"click"],[2,"padding-top","0.2em"]],template:function(t,a){t&1&&(l(0,"div",0)(1,"div",1)(2,"div",2),h(3,"app-spinner",3),v(4,oe,5,2),r()()()),t&2&&(m(3),S("loading",a.loading),m(),g(4,a.loading?-1:4))},dependencies:[B,N,H,R],styles:['.container-fluid[_ngcontent-%COMP%]{height:150vh;background-color:#6ad8d4;background-image:url("./media/main_fondo-S2RK2XML.png");background-size:250px 250px;background-repeat:repeat;background-position:center;padding:20px}.mt-4[_ngcontent-%COMP%]{background-color:#add8e6;height:142vh}.user-card[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #ddd;border-radius:8px;box-shadow:0 4px 6px #0000001a;text-align:center;margin:1em auto 0;padding:16px;width:400px}.user-image[_ngcontent-%COMP%]:hover{cursor:pointer}.user-details[_ngcontent-%COMP%]{font-family:Arial,sans-serif}.user-data[_ngcontent-%COMP%]{font-size:1.2em;margin-bottom:1.2em}.btn-csv[_ngcontent-%COMP%]{margin:1em}']});let o=s;return o})();var Se=(()=>{let s=class s{};s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=$({type:s,selectors:[["app-usuarios-container"]],standalone:!0,features:[T],decls:4,vars:0,consts:[[1,"container-fluid","m-0","p-0"]],template:function(t,a){t&1&&(l(0,"div",0),h(1,"app-navbar")(2,"app-listado-usuarios")(3,"app-footer"),r())},dependencies:[Z,M,A]});let o=s;return o})();export{Se as UsuariosContainerComponent};
