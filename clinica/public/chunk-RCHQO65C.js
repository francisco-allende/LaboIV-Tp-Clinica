import{A as b,B as v,C as I,D as S,E as L,F as A,I as d,J as l,K as j,P as k,u as f,v as p,w as y,z as E}from"./chunk-MT3VMLBQ.js";import{g}from"./chunk-XCRSOGC7.js";import{da as h,h as r,ia as a,o as m}from"./chunk-EWRZD5YS.js";var $=(()=>{let o=class o{constructor(e,t,i,n){this.firestore=e,this.auth=t,this.toast=i,this.router=n,this.loggedUser=new m(null),this.loggedUserKey="loggedUserEmail",this.setLoggedUser=s=>this.loggedUser=s,this.getLoggedUser=()=>localStorage.getItem(this.loggedUserKey),this.configureAuthPersistence(),v(this.auth,s=>{})}configureAuthPersistence(){return r(this,null,function*(){try{yield f(this.auth,p)}catch(e){console.error("Error setting persistence:",e)}})}addToLogger(e){try{let t=l(this.firestore,"logs");d(t,{userEmail:e,fecha:new Date})}catch(t){console.error("Error en el add a los logs:",t)}}isEmailVerificated(){return b().currentUser?.emailVerified}login(e,t){return r(this,null,function*(){S(this.auth,e,t).then(i=>{i.user.email!=null&&(this.isEmailVerificated()?(this.addToLogger(i.user.email),this.setLoggedUser(i.user.email),localStorage.setItem(this.loggedUserKey,e),this.toast.success(`Nos alegra verte de nuevo ${i.user.email}`),this.router.navigateByUrl("/home")):this.toast.error("Debe validar su cuenta en su email para loguearse"))}).catch(i=>{switch(i.code){case"auth/invalid-credential":this.toast.error("Usuario inexistente o contrase\xF1a incorrecta");break;default:this.toast.error("Sucedi\xF3 un error al intentar loguearse");break}console.log(`error en el login: ${i.code}`)})})}logOut(){L(this.auth).then(()=>{localStorage.removeItem(this.loggedUserKey),this.setLoggedUser("")})}register(e){return r(this,null,function*(){E(this.auth,e.email,e.password).then(t=>{if(t.user.email!=null){this.setLoggedUser(t.user.email);let i=l(this.firestore,"users");d(i,{nombre:e.nombre,apellido:e.apellido,edad:e.edad,dni:e.dni,email:e.email,password:e.password,rol:e.rol,mainImg:e.mainImg,extraImg:e.extraImg?e.extraImg:"",obraSocial:e.obraSocial,especialidad:e.especialidad,estado:e.estado,turnos:[],horarios:[],historiaClinica:[]}),this.toast.success("Usuario creado con \xE9xito",`Enviamos un mail de verificacion a ${t.user.email}`),this.router.navigateByUrl("/enviar_email"),I(t.user)}}).catch(t=>{switch(t.code){case"auth/invalid-email":this.toast.error("Email invalido");break;case"auth/email-already-in-use":this.toast.error("Email ya en uso");break;default:this.toast.error("Sucedi\xF3 un error inesperado"),console.log(t);break}})})}getAllEasyLoginUsers(){return r(this,null,function*(){let e=l(this.firestore,"users");try{let t=yield j(e),i=[];t.forEach(u=>{i.push(u.data())});let n=["medicodos@yopmail.com","pacientetres@yopmail.com","adminuno@yopmail.com","pacienteuno@yopmail.com","medicouno@yopmail.com","pacientedos@yopmail.com"];return i.filter(u=>n.includes(u.email))}catch(t){throw console.error("Error obteniendo los usuarios:",t),t}})}};o.\u0275fac=function(t){return new(t||o)(a(A),a(y),a(k),a(g))},o.\u0275prov=h({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();export{$ as a};
